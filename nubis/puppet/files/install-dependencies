#!/bin/bash

# Exit if anything fails
set -e

URL=https://moz-devservices-bmocartons.s3.amazonaws.com/amazon/vendor.tar.gz

echo "Install Bugzilla dependency bundle from $URL"
curl -s --retry 5 -L -o /var/www/bugzilla/vendor.tar.gz $URL
CHECKSUM=$(sha1sum /var/www/bugzilla/vendor.tar.gz | awk '{print $1}')
tar --strip 1 -C /var/www/bugzilla -xf /var/www/bugzilla/vendor.tar.gz
echo "Finished Installing Bugzilla dependency bundle ($CHECKSUM)"

echo "Installing package list from PACAKGES.txt"
# We use httpd24, not httpd
cat /var/www/bugzilla/PACKAGES.txt | grep -v '^httpd-' | xargs yum -y install

exit 0
